---
title: "Final Project"
author: "Xunyuan Sun & Jing Du"
date: "4.19.2020"
output: html_notebook
---

## Clean up environment and load packages
```{r}
# clean up the RStudio environment 
rm(list = ls())

# load all packages here: `mosaic`, `tidyverse`, `DataComputing`, `tidyr` and all others used
library(mosaic)
library(DataComputing)
library(tidyverse)
library(tidyr)
```


## Data Intake

```{r}
# Import and Inspect data
Census_Tract_2015 <-
  read.csv("https://raw.githubusercontent.com/XYSunPSU/Final-Project/master/acs2015_census_tract_data.csv", header = T)

Census_Tract_2015 %>%
  head(5)

```

```{r}
Census_Tract_2017 <-
  read.csv("https://raw.githubusercontent.com/XYSunPSU/Final-Project/master/acs2017_census_tract_data.csv", header = T)

Census_Tract_2017 %>%
  head(5)
```

## Formalize Data Frame

```{r}
# remove state and county from Census_Tract_2017
CenTract2017 <-
  Census_Tract_2017 %>%
  select(-State, -County)
```

```{r}
# add suffix to each column in each data frame

CenTract2017 <-
  CenTract2017 %>%
  rename_all(paste0, "_2017")
```

```{r}
# rename columns
CenTract2015 <-
  Census_Tract_2015 %>%
  rename_all(paste0, "_2015") %>%
  rename(TractID_2015 = "CensusTract_2015", State = "State_2015", County = "County_2015")
```

## Find unemployement rate change in each county in Pennsylvania

1. Filter data where state is pennsylvania
```{r} 
PennStateCensusTract <-
  CenTract2015 %>%
  inner_join(CenTract2017, by = c("TractID_2015" = "TractId_2017")) %>%
  filter(State == "Pennsylvania")
```

2. Calculate the exactly number of people who is unemployed in each tract
```{r}
TractUnemployedPeople <-
  PennStateCensusTract %>%
  select(County, TotalPop_2015, Unemployment_2015, TotalPop_2017, Unemployment_2017) %>%
  mutate(Unemployed2015 = TotalPop_2015 * Unemployment_2015 * 0.01, 
         Unemployed2017 = TotalPop_2017 * Unemployment_2017 * 0.01) %>%
  mutate_at(vars(Unemployed2015, Unemployed2017), list(~ round(., 0))) %>%
  select(County, TotalPop_2015, Unemployed2015, TotalPop_2017, Unemployed2017) %>%
  na.omit()
```

3. Calculate the number of people who is unemployed in each county
```{r}
UnemploymentRateChange <-
  TractUnemployedPeople %>%
  group_by(County) %>%
  summarise(TotPop_2015 = sum(TotalPop_2015), TotUnemployed_2015 = sum(Unemployed2015), 
            TotPop_2017 = sum(TotalPop_2017), TotUnemployed_2017 = sum(Unemployed2017)) %>%
  mutate(UnemployedRate_2015 = TotUnemployed_2015/TotPop_2015, 
         UnemployedRate_2017 = TotUnemployed_2017/TotPop_2017) %>%
  mutate_at(vars(UnemployedRate_2015, UnemployedRate_2017), list(~ round(., 4))) %>%
  select(County, UnemployedRate_2015, UnemployedRate_2017)
  
```

4. Change data frame to narrwo form
```{r}
UnemploymentRateChange_gather <-
  UnemploymentRateChange %>%
  rename(`2015` = "UnemployedRate_2015", `2017` = "UnemployedRate_2017") %>%
  gather(key = Year, value = UnemployedRate, `2015`, `2017`)
```

## Find income change in each county in Pennsylvania

1. Find the total income in each tract 
```{r}
TractTotalIncome <- 
  PennStateCensusTract %>%
  select(County, TotalPop_2015, IncomePerCap_2015, TotalPop_2017, IncomePerCap_2017) %>%
  mutate(TotalIncome_2015 = TotalPop_2015 * IncomePerCap_2015, 
         TotalIncome_2017 = TotalPop_2017 * IncomePerCap_2017) %>%
  na.omit()
```

2. Calculate the exactly income for each county
```{r}
CountyTotalIncome <-
  TractTotalIncome %>%
  group_by(County) %>%
  summarise(TotIncome_2015 = sum(TotalIncome_2015),
            TotIncome_2017 = sum(TotalIncome_2017),
            TotalPop_2015 = sum(TotalPop_2015),
            TotalPop_2017 = sum(TotalPop_2017))
```

3. Find the Per Cap Income for each county
```{r}
PerCapIncome <-
  CountyTotalIncome %>%
  group_by(County) %>%
  mutate(Per_Cap_Income_2015 = TotIncome_2015 / TotalPop_2015,
         Per_Cap_Income_2017 = TotIncome_2017 / TotalPop_2017) %>%
  select(County, Per_Cap_Income_2015, Per_Cap_Income_2017) 
```

4. Change the data frame to narrow form
```{r}
names(PerCapIncome)[2] <- "2015"
names(PerCapIncome)[3] <- "2017"

PerCapIncome_gather <-
  PerCapIncome %>%
  gather(key = Year, value = Per_Cap_Income, `2015`, `2017`)
```

5. Use join to combine per capita income and unemployed rate in the same table.

```{r}
Unemployed_vs_PerCapIncome <- 
  UnemploymentRateChange_gather %>%
  inner_join(PerCapIncome_gather)
```
6.plot

```{r}
ggplot(data = Unemployed_vs_PerCapIncome,aes(x = UnemployedRate, y = Per_Cap_Income)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  facet_wrap(~Year,ncol = 4)
```


## Find poverty in each county

1.
```{r}
TractPoverty <-
  PennStateCensusTract %>%
  select(County, TotalPop_2015, Poverty_2015, TotalPop_2017, Poverty_2017) %>%
  mutate(Poverty_2015 = TotalPop_2015 * Poverty_2015 * 0.01, 
         Poverty_2017 = TotalPop_2017 * Poverty_2017 * 0.01) %>%
  mutate_at(vars(Poverty_2015, Poverty_2017), list(~ round(., 0))) %>%
  na.omit()
```

2.
```{r}
CountyPoverty <-
  TractPoverty %>%
  group_by(County) %>%
  summarise(TotPop_2015 = sum(TotalPop_2015), TotPoverty_2015 = sum(Poverty_2015), 
            TotPop_2017 = sum(TotalPop_2017), TotPoverty_2017 = sum(Poverty_2017)) %>%
  mutate(`2015`= TotPoverty_2015/TotPop_2015, 
         `2017` = TotPoverty_2017/TotPop_2017) %>%
  mutate_at(vars(`2015`, `2017`), list(~ round(., 4))) %>%
  select(County, `2015`, `2017`)
```

3.
```{r}
CountyPoverty_gather <-
  CountyPoverty %>%
  gather(key = Year, value = Poverty, `2015`, `2017`)
```

```{r}
 ggplot( data = CountyPoverty_gather, aes(x = Poverty)) + 
  geom_density(adjust = 0.5) + 
  labs(title = "") +
  facet_wrap(~Year,ncol = 4)
```


4. Use join to combine per capita income and poverty rate in the same table.

```{r}
Poverty_vs_PerCapIncome <- 
  CountyPoverty_gather %>%
  inner_join(PerCapIncome_gather)
```
5.plot

```{r}
ggplot(data = Poverty_vs_PerCapIncome,aes(x = Poverty, y = Per_Cap_Income)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  facet_wrap(~Year,ncol = 4)
```


## Find the number of each Occupation in each county

1.Let's divide the profession into five areas, they are Professional(people who employed in management, business, science, and arts), Service(people who employed in service jobs),  Office(people who employed in sales and office jobs) ,Construction(people who employed in natural resources, construction, and maintenance) and 
Production(people who employed in production, transportation, and material movement). 

```{r}
TractOccupation <-
  PennStateCensusTract %>%
  select(County, TotalPop_2015, Professional_2015, Service_2015, Office_2015, Construction_2015,
         Production_2015, TotalPop_2017, Professional_2017, Service_2017, Office_2017, 
         Construction_2017, Production_2017) %>%
  mutate(Professional_2015 = TotalPop_2015 * Professional_2015 * 0.01,
         Service_2015 = TotalPop_2015 * Service_2015 * 0.01,
         Office_2015 = TotalPop_2015 * Office_2015 * 0.01,
         Construction_2015 = TotalPop_2015 * Construction_2015 * 0.01,
         Production_2015 = TotalPop_2015 * Production_2015 * 0.01,
         Professional_2017 = TotalPop_2017 * Professional_2017 * 0.01,
         Service_2017 = TotalPop_2017 * Service_2017 * 0.01,
         Office_2017 = TotalPop_2017 * Office_2017 * 0.01,
         Construction_2017 = TotalPop_2017 * Construction_2017 * 0.01,
         Production_2017 = TotalPop_2017 * Production_2017 * 0.01) %>%
  mutate_at(vars(Professional_2015, Service_2015, Office_2015, Construction_2015,
         Production_2015, Professional_2017, Service_2017, Office_2017, 
         Construction_2017, Production_2017), list(~ round(., 0))) %>%
  na.omit()
```




```{r}
CountyOccupation <-
  TractOccupation %>%
  group_by(County) %>%
  summarise(TotPop_2015 = sum(TotalPop_2015), TotProfessional_2015 = sum(Professional_2015),
            TotService_2015 = sum(Service_2015), TotOffice_2015 = sum(Office_2015),
            TotConstruction_2015 = sum(Construction_2015), TotProduction_2015 = sum(Production_2015),
            TotPop_2017 = sum(TotalPop_2017), TotProfessional_2017 = sum(Professional_2017),
            TotService_2017 = sum(Service_2017), TotOffice_2017 = sum(Office_2017),
            TotConstruction_2017 = sum(Construction_2017), TotProduction_2017 = sum(Production_2017)) %>%
  mutate(Professional_2015 = TotProfessional_2015/TotPop_2015,
         Service_2015 = TotService_2015/TotPop_2015,
         Office_2015 = TotOffice_2015/TotPop_2015,
         Construction_2015 = TotConstruction_2015/TotPop_2015,
         Production_2015 = TotProduction_2015/TotPop_2015,
         Professional_2017 = TotProfessional_2017/TotPop_2017,
         Service_2017 = TotService_2017/TotPop_2017,
         Office_2017 = TotOffice_2017/TotPop_2017,
         Construction_2017 = TotConstruction_2017/TotPop_2017,
         Production_2017 = TotProduction_2017/TotPop_2017) %>%
  select(County, Professional_2015, Service_2015, Office_2015, Construction_2015,
         Production_2015, Professional_2017, Service_2017, Office_2017, 
         Construction_2017, Production_2017)
```


```{r}

 ggplot( data = CountyPoverty_gather, aes(x = Poverty)) + 
  geom_point() + 
  facet_wrap(~Year,ncol = 4)

```



