---
title: "Final Project"
author: "Xunyuan Sun & Jing Du"
date: "4.19.2020"
output: html_notebook
---

## Clean up environment and load packages
```{r}
# clean up the RStudio environment 
rm(list = ls())

# load all packages here: `mosaic`, `tidyverse`, `DataComputing`, `tidyr` and all others used
library(mosaic)
library(DataComputing)
library(tidyverse)
library(tidyr)
```


## Data Intake

```{r}
# Import and Inspect data
Census_Tract_2015 <-
  read.csv("https://raw.githubusercontent.com/XYSunPSU/Final-Project/master/acs2015_census_tract_data.csv", header = T)

Census_Tract_2015 %>%
  head(5)
```

```{r}
Census_Tract_2017 <-
  read.csv("https://raw.githubusercontent.com/XYSunPSU/Final-Project/master/acs2017_census_tract_data.csv", header = T)

Census_Tract_2017 %>%
  head(5)
```

## Formalize Data Frame

```{r}
# remove state and county from Census_Tract_2017
CenTract2017 <-
  Census_Tract_2017 %>%
  select(-State, -County)
```

```{r}
# add suffix to each column in each data frame

CenTract2017 <-
  CenTract2017 %>%
  rename_all(paste0, "_2017") %>%
  mutate(Year = "2017")
```

```{r}
# rename columns
CenTract2015 <-
  Census_Tract_2015 %>%
  rename_all(paste0, "_2015") %>%
  rename(TractID_2015 = "CensusTract_2015", State = "State_2015", County = "County_2015") %>%
  mutate(Year = "2015")
```

## Find unemployement rate change in each county in Pennsylvania

1. Filter data where state is pennsylvania
```{r} 
PennStateCensusTract <-
  CenTract2015 %>%
  inner_join(CenTract2017, by = c("TractID_2015" = "TractId_2017")) %>%
  filter(State == "Pennsylvania")
```

2. Calculate the exactly number of people who is unemployed in each tract
```{r}
TractUnemployedPeople <-
  PennStateCensusTract %>%
  select(County, TotalPop_2015, Unemployment_2015, TotalPop_2017, Unemployment_2017) %>%
  mutate(Unemployed2015 = TotalPop_2015 * Unemployment_2015 * 0.01, 
         Unemployed2017 = TotalPop_2017 * Unemployment_2017 * 0.01) %>%
  mutate_at(vars(Unemployed2015, Unemployed2017), list(~ round(., 0))) %>%
  select(County, TotalPop_2015, Unemployed2015, TotalPop_2017, Unemployed2017) %>%
  na.omit()
```

3. Calculate the number of people who is unemployed in each county
```{r}
UnemploymentRateChange <-
  TractUnemployedPeople %>%
  group_by(County) %>%
  summarise(TotPop_2015 = sum(TotalPop_2015), TotUnemployed_2015 = sum(Unemployed2015), 
            TotPop_2017 = sum(TotalPop_2017), TotUnemployed_2017 = sum(Unemployed2017)) %>%
  mutate(UnemployedRate_2015 = TotUnemployed_2015/TotPop_2015, 
         UnemployedRate_2017 = TotUnemployed_2017/TotPop_2017) %>%
  mutate_at(vars(UnemployedRate_2015, UnemployedRate_2017), list(~ round(., 4))) %>%
  select(County, UnemployedRate_2015, UnemployedRate_2017)
  
```

4. Change data frame to narrwo form
```{r}
UnemploymentRateChange_gather <-
  UnemploymentRateChange %>%
  rename(`2015` = "UnemployedRate_2015", `2017` = "UnemployedRate_2017") %>%
  gather(key = when, value = UnemployedRate, `2015`, `2017`)
```

## Find income change in each county in Pennsylvania

1. Find the total income in each tract 
```{r}
TractTotalIncome <- 
  PennStateCensusTract %>%
  select(County, TotalPop_2015, IncomePerCap_2015, TotalPop_2017, IncomePerCap_2017) %>%
  mutate(TotalIncome_2015 = TotalPop_2015 * IncomePerCap_2015, 
         TotalIncome_2017 = TotalPop_2017 * IncomePerCap_2017) %>%
  na.omit()
```

2. Calculate the exactly income for each county
```{r}
CountyTotalIncome <-
  TractTotalIncome %>%
  group_by(County) %>%
  summarise(TotIncome_2015 = sum(TotalIncome_2015),
            TotIncome_2017 = sum(TotalIncome_2017),
            TotalPop_2015 = sum(TotalPop_2015),
            TotalPop_2017 = sum(TotalPop_2017))
```

3. Find the Per Cap Income for each county
```{r}
PerCapIncome <-
  CountyTotalIncome %>%
  group_by(County) %>%
  mutate(Per_Cap_Income_2015 = TotIncome_2015 / TotalPop_2015,
         Per_Cap_Income_2017 = TotIncome_2017 / TotalPop_2017) %>%
  select(County, Per_Cap_Income_2015, Per_Cap_Income_2017) 
```

4. Change the data frame to narrow form
```{r}
names(PerCapIncome)[2] <- "2015"
names(PerCapIncome)[3] <- "2017"

PerCapIncome_gather <-
  PerCapIncome %>%
  gather(key = when, value = Per_Cap_Income, `2015`, `2017`)
```


